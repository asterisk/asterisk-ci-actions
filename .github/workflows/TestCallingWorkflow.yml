name: TestCallingWorkflow
run-name: "TestCallingWorkflow"
on:
  workflow_dispatch:

jobs:
  Job1:
    runs-on: ubuntu-latest
    env:
      FROM_JOB: "from job"
    defaults:
      run:
        shell: bash
    outputs:
      testgroup:      ${{ steps.st1.outputs.TESTGROUP }}
      testobject:      ${{ steps.st1.outputs.TESTOBJECT }}
    steps:
      - name: Test ENV
        id: st1
        run: |
          {
            echo "TESTGROUP=pjs5" >> ${GITHUB_OUTPUT}
            echo 'TESTOBJECT<<EOF'
            cat <<-EOFINNER
            {
            "pjs5": {
                "name": "pjs5",
                "dir": "tests/CI/output/pjsip5",
                "timeout": 240,
                "step_timeout_minutes": 45,
                "options": "",
                "testcmd": "--test-regex=tests/channels/pjsip/[s]"
            }
            }
          EOFINNER
            echo "EOF"
          } >> ${GITHUB_OUTPUT}

  Job2:
    needs: Job1
    uses: ./.github/workflows/TestCalledWorkflow.yml
    with:
      gatetest_group: ${{ needs.Job1.outputs.testgroup }}
      gatetest_commands: ${{ needs.Job1.outputs.testobject }}

